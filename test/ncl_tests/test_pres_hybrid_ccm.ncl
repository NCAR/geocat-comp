;***********************
; generates an output array and saves it
; values subset of atmos.nc on geocat-datafiles
;***********************
;
; These files are loaded by default in NCL V6.2.0 and newer
; load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"
; load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_csm.ncl"
;===========================

begin

  ;===================================================================
  ; set up data
  ;===================================================================
  p0 = 100000.

  hyam = (/ 0.00364347, 0.00759482, 0.01435663, 0.02461222, 0.0382683, \
       0.05459548, 0.07201245, 0.08782123, 0.10331713, 0.12154724, \
       0.14299405, 0.16822508, 0.17823067, 0.17032433, 0.1610229 , \
       0.1500803 , 0.13720685, 0.12206194, 0.10424471, 0.08497915, \
       0.06650169, 0.05019679, 0.03718866, 0.02843195, 0.02220898, \
       0.01640738, 0.01107456, 0.00625495, 0.00198941, 0. /)

  hybm = (/ 0.  , 0.        , 0.        , 0.        , 0.        , \
       0.        , 0.        , 0.        , 0.        , 0.        , \
       0.        , 0.        , 0.01967741, 0.06250429, 0.1128879 , \
       0.17216161, 0.24189404, 0.32393062, 0.42044246, 0.5247995 , \
       0.6248877 , 0.7132077 , 0.7836697 , 0.83110285, 0.8648113 , \
       0.89623713, 0.9251238 , 0.9512305 , 0.974336  , 0.9925561 /)

  ps = (/ (/ 68532.88, 68286.49, 68045.18, 67809.64, 67580.56, 67358.57, 67144.234 /), \
         (/ 69044.58, 68445.016, 67873.24, 67329.56, 66813.87, 66325.73, 65864.47 /), \
         (/ 68233.875, 67374.71, 66604.07, 65917.24, 65308.066, 64769.35, 64293.375 /), \
         (/ 66060.04, 65000.55, 64124.547, 63422.473, 62880.082, 62479.62, 62201.19 /), \
         (/ 66818.84, 65470.18, 64400.82, 63602.953, 63056.59, 62731.6, 62590.535 /), \
         (/ 74023.27, 72466.97, 71228.3, 70311.805, 69698.95, 69349.88, 69206.85 /), \
         (/ 85847.78, 84576.4, 83540.36, 82763.03, 82241.54, 81945.26, 81816.04 /) /)

  ;===================================================================
  ; run pres_hybrid_ccm
  ;===================================================================
  pm = pres_hybrid_ccm(ps,p0,hyam,hybm)

  ;===================================================================
  ; write out to file
  ;===================================================================
  system("/bin/rm -f ./pres_hybrid_ccm_output.nc")   ; remove any pre-existing file
  ncdf = addfile("./pres_hybrid_ccm_output.nc" ,"c")  ; open output netCDF file

  ncdf->hyam  = hyam
  ncdf->hybm  = hybm
  ncdf->ps  = ps
  ncdf->pm  = pm


end
